/*
teamcity-demo-project 0.0.0
Simple JS full stack project to test TeamCity CI 
Built on 2014-08-06
*/
"use strict";angular.module("tcApp",["ui.router","ngResource"]),angular.module("tcApp").config(function(a,b){b.html5Mode(!0),a.state("index",{url:"/",templateUrl:"/partials/main/partials/main",controller:"MainCtrl"}).state("signup",{url:"/signup",templateUrl:"/partials/auth/partials/signup",controller:"NavBarLoginCtrl"}).state("chat",{url:"/chat",templateUrl:"/partials/chat/partials/chat-index",controller:"ChatCtrl"})}),angular.module("tcApp").factory("Auth",function(a,b,c,d){return{authenticateUser:function(e,f){var g=b.defer();return a.post("/login",{username:e,password:f}).then(function(a){if(a.data.success){var b=new d;angular.extend(b,a.data.user),c.currentUser=b,g.resolve(!0)}else g.resolve(!1)}),g.promise},logoutUser:function(){var d=b.defer();return a.post("/logout",{logout:!0}).then(function(){c.currentUser=void 0,d.resolve(!0)}),d.promise},createUser:function(a){var e=new d(a),f=b.defer();return e.$save().then(function(){c.currentUser=e,f.resolve(!0)},function(a){f.reject(a.data)}),f.promise}}}),angular.module("tcApp").factory("Identity",function(a,b){var c;return a.currentUserObj&&(c=new b,angular.extend(c,a.currentUserObj)),{currentUser:c,isAuthenticated:function(){return!!this.currentUser}}}),angular.module("tcApp").controller("NavBarLoginCtrl",function(a,b,c,d,e){a.identity=e,a.signin=function(e,f){c.authenticateUser(e,f).then(function(c){c?(d.notify("You have been successfully signed in!"),b.go("chat")):(a.username="",a.password="",d.error("User/Password incorrect!"))})},a.signout=function(){c.logoutUser().then(function(){a.username="",a.password="",d.notify("You have been successfully signed out!"),b.go("index")})},a.signup=function(){var e={username:a.email,password:a.password,firstName:a.firstName,lastName:a.lastName};c.createUser(e).then(function(){d.notify("Your account has been created!"),b.go("chat")},function(a){d.error(a)})}}),angular.module("tcApp").factory("Chat",function(a,b,c){return{sendMessage:function(a){var d=new c(a),e=b.defer();return d.$save().then(function(){e.resolve(!0)},function(a){e.reject(a.data)}),e.promise}}}),angular.module("tcApp").controller("ChatCtrl",function(a,b,c,d,e){a.identity=c,a.chat={},a.chat.messages=e.query(),a.sendMessage=function(c,e){var f=c.firstName+" "+c.lastName,g={author:f,text:e,date:new Date};b.sendMessage(g).then(function(b){b?(a.chat.messages.push(g),a.chat.message=""):d.error("Could not send your message!")})}}),angular.module("tcApp").factory("ChatResource",function(a){var b=a("/api/v1/chat/:id",{_id:"@id"});return b}),angular.module("tcApp").value("Toastr",toastr),angular.module("tcApp").factory("Notifier",function(a){return{notify:function(b){a.success(b)},error:function(b){a.error(b)}}}),angular.module("tcApp").controller("MainCtrl",function(){}),angular.module("tcApp").factory("UserResource",function(a){var b=a("/api/v1/users/:id",{_id:"@id"},{update:{url:"/api/v1/users/:id",method:"PUT",isArray:!1}});return b});